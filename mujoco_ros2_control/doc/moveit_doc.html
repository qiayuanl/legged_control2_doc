

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>How To Setup mujoco_ros2_control &mdash; legged_control2 0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=2709fde1"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            legged_control2
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting-started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../digging-deeper.html">Digging Deeper</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api_list/api_list.html">API Documentation</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">legged_control2</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">How To Setup mujoco_ros2_control</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/mujoco_ros2_control/doc/moveit_doc.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="how-to-setup-mujoco-ros2-control">
<h1>How To Setup mujoco_ros2_control<a class="headerlink" href="#how-to-setup-mujoco-ros2-control" title="Link to this heading"></a></h1>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Link to this heading"></a></h2>
<p>This document provides guidance on how to setup and use <code class="docutils literal notranslate"><span class="pre">mujoco_ros2_control</span></code> package.
This page will demonstrate the supported MuJoCo simulation features with a robot manipulator.
However, this package is not specifically designed for manipulation and can be used for any types of robots.</p>
</section>
<section id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Link to this heading"></a></h2>
<section id="running-on-the-local-machine">
<h3>Running on the local machine<a class="headerlink" href="#running-on-the-local-machine" title="Link to this heading"></a></h3>
<p>If you want to run an application on the local machine, you need following dependencies installed on the machine.</p>
<ol class="arabic simple">
<li><p><a class="reference external" href="https://github.com/google-deepmind/mujoco">MuJoCo</a></p></li>
<li><p><a class="reference external" href="https://docs.ros.org/en/humble/Installation.html">ROS 2 humble</a></p></li>
<li><p><a class="reference external" href="https://github.com/moveit/moveit2">MoveIt 2</a></p></li>
</ol>
</section>
</section>
<section id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Link to this heading"></a></h2>
<section id="id1">
<h3>Running on the local machine<a class="headerlink" href="#id1" title="Link to this heading"></a></h3>
<ol class="arabic simple">
<li><p>Create a workspace</p></li>
</ol>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir<span class="w"> </span>-p<span class="w"> </span>~/mujoco_ros_ws/src
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="2">
<li><p>Clone the repository.</p></li>
</ol>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>~/mujoco_ros_ws/src
git<span class="w"> </span>clone<span class="w"> </span>https://github.com/sangteak601/mujoco_ros2_control.git
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="3">
<li><p>Set environment variable</p></li>
</ol>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span><span class="w"> </span><span class="nv">MUJOCO_DIR</span><span class="o">=</span>/PATH/TO/MUJOCO/mujoco-3.x.x
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="4">
<li><p>Build the package</p></li>
</ol>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>apt<span class="w"> </span>update<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>rosdep<span class="w"> </span>install<span class="w"> </span>-r<span class="w"> </span>--from-paths<span class="w"> </span>.<span class="w"> </span>--ignore-src<span class="w"> </span>--rosdistro<span class="w"> </span><span class="nv">$ROS_DISTRO</span><span class="w"> </span>-y
<span class="nb">source</span><span class="w"> </span>/opt/ros/<span class="si">${</span><span class="nv">ROS_DISTRO</span><span class="si">}</span>/setup.bash
<span class="nb">cd</span><span class="w"> </span>~/mujoco_ros_ws
colcon<span class="w"> </span>build
</pre></div>
</div>
</div></blockquote>
</section>
</section>
<section id="id2">
<h2>How to Setup mujoco_ros2_control<a class="headerlink" href="#id2" title="Link to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Please refer to <a class="reference external" href="https://github.com/sangteak601/mujoco_ros2_control/blob/moveit_doc/doc/index.rst#usage">this</a> for the details.</p>
</div>
<section id="set-ros2-control-plugin-in-the-urdf">
<h3>Set ros2_control plugin in the URDF<a class="headerlink" href="#set-ros2-control-plugin-in-the-urdf" title="Link to this heading"></a></h3>
<p>You can configure the <cite>ros2_control</cite> hardware system plugin for MuJoCo in the URDF file as follows:</p>
<div class="highlight-XML notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ros2_control</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;MujocoSystem&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;system&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;hardware&gt;</span>
<span class="w">    </span><span class="nt">&lt;plugin&gt;</span>mujoco_ros2_control/MujocoSystem<span class="nt">&lt;/plugin&gt;</span>
<span class="w">  </span><span class="nt">&lt;/hardware&gt;</span>
<span class="nt">&lt;/ros2_control&gt;</span>
</pre></div>
</div>
<p>You can also set parameters for the plugin such as pid gains, min/max effort and so on.
To find examples of parameters, please see <a class="reference external" href="https://github.com/sangteak601/mujoco_ros2_control/tree/moveit_doc/mujoco_ros2_control_demos/urdf">urdf examples</a>.</p>
</section>
<section id="create-mjcf-mujoco-xml-format">
<h3>Create MJCF(MuJoCo xml format)<a class="headerlink" href="#create-mjcf-mujoco-xml-format" title="Link to this heading"></a></h3>
<p>You need to convert the URDF model to a MJCF XML file.
Make sure to use the <strong>same name</strong> for the <code class="docutils literal notranslate"><span class="pre">link</span></code> and <code class="docutils literal notranslate"><span class="pre">joint</span></code>, which are mapped to the <code class="docutils literal notranslate"><span class="pre">body</span></code> and <code class="docutils literal notranslate"><span class="pre">joint</span></code> in MuJoCo.
You can specify position limits in <code class="docutils literal notranslate"><span class="pre">&lt;limit&gt;</span></code> in MJCF, and effort limits in URDF as shown in this
<a class="reference external" href="https://github.com/sangteak601/mujoco_ros2_control/blob/moveit_doc/mujoco_ros2_control_demos/urdf/test_cart_effort.xacro.urdf">example</a>
Velocity limits will not be applied at all.</p>
<p>Any force torque sensors need to be mapped to separate force and torque sensors in the MJCF, since there is no support for combined sensors in MuJoCo.
The name of each sensor should be sensor_name + _force and sensor_name + _torque.
For example, if you have a force torque sensor called <code class="docutils literal notranslate"><span class="pre">my_sensor</span></code>, you need to create <code class="docutils literal notranslate"><span class="pre">my_sensor_force</span></code> and <code class="docutils literal notranslate"><span class="pre">my_sensor_torque</span></code> in MJCF.</p>
<p>Check <a class="reference external" href="https://github.com/sangteak601/mujoco_ros2_control/tree/moveit_doc/mujoco_ros2_control_demos/mujoco_models">mujoco_models</a> for examples.</p>
</section>
<section id="specify-the-path-to-mjcf-and-controller-config">
<h3>Specify the path to MJCF and controller config<a class="headerlink" href="#specify-the-path-to-mjcf-and-controller-config" title="Link to this heading"></a></h3>
<p>You need to pass the path to MJCF as <code class="docutils literal notranslate"><span class="pre">mujoco_model_path</span></code> parameter to the node.
You also need to pass controller configuration since <code class="docutils literal notranslate"><span class="pre">mujoco_ros2_control</span></code> is replacing <code class="docutils literal notranslate"><span class="pre">ros2_control</span></code> node.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">controller_config_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mujoco_ros2_control_demos_path</span><span class="p">,</span> <span class="s1">&#39;config&#39;</span><span class="p">,</span> <span class="s1">&#39;cartpole_controller_position.yaml&#39;</span><span class="p">)</span>

<span class="n">node_mujoco_ros2_control</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span>
    <span class="n">package</span><span class="o">=</span><span class="s1">&#39;mujoco_ros2_control&#39;</span><span class="p">,</span>
    <span class="n">executable</span><span class="o">=</span><span class="s1">&#39;mujoco_ros2_control&#39;</span><span class="p">,</span>
    <span class="n">output</span><span class="o">=</span><span class="s1">&#39;screen&#39;</span><span class="p">,</span>
    <span class="n">parameters</span><span class="o">=</span><span class="p">[</span>
        <span class="n">robot_description</span><span class="p">,</span>
        <span class="n">controller_config_file</span><span class="p">,</span>
        <span class="p">{</span><span class="s1">&#39;mujoco_model_path&#39;</span><span class="p">:</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mujoco_ros2_control_demos_path</span><span class="p">,</span> <span class="s1">&#39;mujoco_models&#39;</span><span class="p">,</span> <span class="s1">&#39;test_cart_position.xml&#39;</span><span class="p">)}</span>
    <span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="running-the-moveit-interactive-marker-demo-with-mujoco">
<h2>Running the MoveIt Interactive Marker Demo with MuJoCo<a class="headerlink" href="#running-the-moveit-interactive-marker-demo-with-mujoco" title="Link to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Please refer to <a class="reference external" href="https://github.com/sangteak601/mujoco_ros2_control_examples/tree/main/mujoco_panda">this</a> for running the demo.</p>
</div>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Qiayuan Liao.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>